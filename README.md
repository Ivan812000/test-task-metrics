# Карта кликов - Тестовое задание 

## Описание задания

Карта кликов.
Нам нужно увидеть места, где пользователи чаще всего кликают на сайте, и в какие часы проявляют наибольшую активность.

Решение должно состоять из двух частей:
1. JS-код, который можно внедрить на любой сайт.
   Скрипт отслеживает дату, время и координаты кликов, передаёт их в нашу админку.
2. Сайт-админка на laravel, на котором можно увидеть информацию для каждого сайта, который мы мониторим:
- список всех отслеживаемых сайтов, с возможностью добавления нового
- карта кликов (что-то простое, похожее на Яндекс-метрику)
- график распределения активности пользователя по часам (в какие часы сколько было кликов)


## 1. JS-скрипт для отслеживания кликов
### Внедрение JS-скрипта для отслеживания кликов

Для отслеживания кликов на сайте, вам нужно внедрить следующий JS-скрипт. Этот скрипт будет отправлять данные о кликах (координаты, время, сайт) на наш сервер для обработки.

### JS-скрипт для отслеживания 

```html
<script>
    function getCsrfToken() {
        return fetch("http://127.0.0.1:8000/api/csrf-token", {
            method: "GET",
            headers: { "Accept": "application/json" }
        })
            .then(response => {
                if (!response.ok) throw new Error("Ошибка получения CSRF-токена");
                return response.json();
            })
            .then(data => data.csrf_token);
    }

    document.addEventListener("click", function (event) {
        getCsrfToken().then(csrfToken => {
            const x = event.clientX;
            const y = event.clientY;
            const timestamp = new Date().toISOString();
            const site_id = '3';  // ID вашего сайта, для которого отслеживаются клики
            const url = window.location.href;  // Текущий URL страницы
            const data = { x, y, timestamp, site_id, url,  _token: csrfToken };

            // Отправка данных на сервер
            return fetch("http://127.0.0.1:8000/api/clicks/", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });
        })
        .then(response => response.json())
        .then(data => console.log("Клик записан:", data))
        .catch(error => console.error("Ошибка:", error));
    });
</script>
```

## 2. Laravel Админка

На админ-панели можно:
- Добавлять новые сайты для мониторинга.
- Просматривать данные о кликах.
- Видеть карту кликов (аналог Яндекс-метрики).
- Смотреть график распределения активности по часам (в какие часы было больше всего кликов).


# Установка

### Шаги для установки

1. Клонируйте репозиторий:

    ```bash
    git clone https://github.com/yourusername/click-tracking.git
    cd click-tracking
    ```

2. Установите PHP зависимости:

    ```bash
    composer install
    ```

3. Установите фронтенд зависимости (если используется Vue.js):

    ```bash
    npm install
    ```

4. Создайте файл `.env`:

    ```bash
    cp .env.example .env
    ```

5. Сгенерируйте ключ приложения:

    ```bash
    php artisan key:generate
    ```

6. Настройте подключение к базе данных в файле `.env`:

    ```env
    DB_CONNECTION=mysql
    DB_HOST=127.0.0.1
    DB_PORT=3306
    DB_DATABASE=your_database
    DB_USERNAME=your_username
    DB_PASSWORD=your_password
    ```

7. Выполните миграции и сиды базы данных:

    ```bash
    php artisan migrate --seed
    ```

8. Запустите сервер:

    ```bash
    php artisan serve
    ```

9. Для начала работы с фронтендом вашего проекта запустите команду:

    ```bash
    npm run dev
    ```

Теперь ваше приложение должно быть доступно по адресу `http://127.0.0.1:8000`.

## Использование

### 1. Добавление нового сайта
- Перейдите в админку и добавьте новый сайт для отслеживания.
- Укажите название и URL сайта.

### 2. Отслеживание кликов
- Внедрите JS-скрипт на ваш сайт.(Этот скрипт есть также на странице http://127.0.0.1:8000/track-clicks)
- Скрипт будет отслеживать клики и отправлять данные на сервер.

### 3. Просмотр карты кликов
- Перейдите в раздел карты кликов на админ-панели.
- Карта отобразит места, где были зафиксированы клики, и покажет интенсивность кликов.

### 4. Просмотр графика активности по часам
- Перейдите в раздел статистики кликов.
- График покажет, в какие часы было больше всего кликов.

